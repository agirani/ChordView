<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Ensures proper rendering and touch zooming on mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>ChordPro Viewer ðŸŽ¸</title>

  <!-- Link to your PWA manifest (defines app name, icons, theme colors) -->
  <link rel="manifest" href="manifest.json">

  <!-- Theme color for browser UI (used on Android/desktop) -->
  <meta name="theme-color" content="#222222">

  <!-- iOS specific meta tags to make it installable -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icon-192.png">

  <!-- Optional: link to your CSS file -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>ChordPro Viewer ðŸŽ¸</h1>

  <!-- File input: allows user to pick one or more ChordPro files from Files app -->
  <input type="file" id="fileInput"
         accept=".pro,.cho,.chordpro,.txt,text/plain"
         multiple>
  <br>
  <!-- Controls for transposing chords up/down -->
  <label for="transpose">Transpose</label>
  <input type="number" id="transpose" value="0">

  <!-- Controls for font size -->
  <label for="fontSize">Font size:</label>
  <input type="number" id="fontSize" value="12">

  <!-- Controls for number of columns -->
  <label for="columns">Columns:</label>
  <input type="number" id="columns" value="1">

  <!-- Container where parsed songs will be rendered -->
  <div id="output"></div>

  <!-- Load ChordSheetJS library (either from CDN or local copy) -->
  <script src="chordsheet.min.js"></script>

  <script>
    // Register service worker for offline/PWA support
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker registered"));
    }

    // Handle file input change
    document.getElementById("fileInput").addEventListener("change", function(e) {
      const files = e.target.files;
      if (!files.length) return;

      // Clear previous output
      document.getElementById("output").innerHTML = "";

      // Loop through all selected files
      Array.from(files).forEach(file => {
        const reader = new FileReader();

        reader.onload = function(evt) {
          const text = evt.target.result;

          // Parse ChordPro text into a song object
          const parser = new ChordSheetJS.ChordProParser();
          let song = parser.parse(text);

          // Apply transpose (value from input)
          const transposeValue = parseInt(document.getElementById("transpose").value, 10);
          if (transposeValue !== 0) {
            const transposer = new ChordSheetJS.Transposer(transposeValue);
            song = transposer.transpose(song);
          }

          // Format song into HTML table
          const formatter = new ChordSheetJS.HtmlTableFormatter();
          const rendered = formatter.format(song);

          // Create a container for this song
          const container = document.createElement("div");
          container.classList.add("song");
          container.style.fontSize = document.getElementById("fontSize").value + "px";
          container.innerHTML = rendered;

          // Append to output
          document.getElementById("output").appendChild(container);
        };

        // Read file as text
        reader.readAsText(file);
      });
    });
  </script>
</body>
</html>
